# アーキテクチャ設計

## システム構成
### アーキテクチャ設計 | システム構成  
  
#### 全体アーキテクチャ  
テスト問題エディタは、シンプルで効率的な操作性を重視したデスクトップアプリケーションとして設計します。以下のアーキテクチャパターンを採用します：  
  
- **アーキテクチャパターン**: MVVM（Model-View-ViewModel）  
    - 複雑なUI操作と状態管理が必要なエディタアプリケーションに適したパターン  
    - データバインディングによりUI更新を効率化  
    - テスト容易性を向上  
  
#### 主要コンポーネント  
1. **プレゼンテーション層**  
    - **View**: ユーザーインターフェース（画面）  
    - **ViewModel**: 表示ロジックとデータ状態管理  
  
2. **ビジネスロジック層**  
    - **テスト問題管理サービス**: テスト問題のCRUD操作  
    - **LaTeXレンダリングサービス**: 数式のプレビュー生成  
    - **インポート/エクスポートサービス**: CSVファイル入出力  
  
3. **データアクセス層**  
    - **ローカルストレージマネージャ**: テスト問題データの永続化  
    - **ファイル入出力マネージャ**: CSVファイル操作  
  
#### コンポーネント間連携  
- **イベント駆動型通信**: UI操作に応じたコンポーネント間通信  
- **依存性注入**: コンポーネント間の疎結合性確保

## インフラ構成
### アーキテクチャ設計 | インフラ構成  
  
#### デプロイメント構成  
テスト問題エディタは、単一ユーザー用デスクトップアプリケーションとして設計されており、サーバーインフラは不要です。  
  
1. **デスクトップアプリケーション**  
    - Windows、macOS、Linuxの主要OSをサポート  
    - スタンドアロンアプリケーションとして動作（インストーラー提供）  
    - 必要なランタイムはアプリケーションに同梱  
  
2. **ローカルストレージ**  
    - ユーザーのホームディレクトリ内にアプリケーションデータフォルダを作成  
    - SQLite埋め込みデータベースを使用してテスト問題データを保存  
    - 設定ファイルはOSの標準的な場所に保存（Windows: AppData, macOS: Library, Linux: .config）  
  
#### ハードウェア要件  
1. **最小要件**  
    - CPU: デュアルコア 1.6GHz以上  
    - メモリ: 4GB以上  
    - ストレージ: 500MB以上の空き容量  
    - ディスプレイ: 1280×720以上の解像度  
  
2. **推奨要件**  
    - CPU: クアッドコア 2.0GHz以上  
    - メモリ: 8GB以上  
    - ストレージ: 1GB以上の空き容量（バックアップ用）  
    - ディスプレイ: 1920×1080以上の解像度  
  
#### ソフトウェア依存関係  
1. **必要なランタイム**  
    - .NET 6.0以上（Windows）  
    - Mono 6.12以上（macOS/Linux）  
    - SQLite 3.35以上  
  
2. **外部ライブラリ**  
    - MathJax（LaTeX数式レンダリング）  
    - CsvHelper（CSVファイル処理）  
    - SQLite.NET（データベースアクセス）  
  
#### 更新メカニズム  
1. **自動更新**  
    - アプリケーション起動時に更新確認  
    - バックグラウンドダウンロードと次回起動時の適用  
    - 更新の延期オプション  
  
2. **更新配布**  
    - デジタル署名付きの更新パッケージ  
    - 差分更新によるダウンロードサイズの最小化

## バックエンド
### アーキテクチャ設計 | バックエンド  
  
#### データストレージ  
- **埋め込みデータベース**: SQLiteを使用したローカルデータ保存  
    - テスト問題データの永続化に最適  
    - アプリケーションと一体化し、別途DBサーバー不要  
  
#### 主要モジュール  
1. **テスト問題リポジトリ**  
    - テスト問題のCRUD操作を担当  
    - 階層構造データの管理機能  
  
2. **CSVデータ処理モジュール**  
    - CSVファイルのパース処理  
    - データマッピングとバリデーション  
    - エクスポートフォーマット生成  
  
3. **LaTeXレンダリングエンジン**  
    - 数式テキストのレンダリング処理  
    - プレビュー画像生成  
  
#### エラーハンドリング  
- 例外処理の一元管理  
- ユーザーフレンドリーなエラーメッセージ変換  
  
#### 技術スタック  
- **言語**: TypeScript  
- **データベース**: SQLite（埋め込みDB）  
- **ORM**: TypeORM  
- **ファイル処理**: csv-parse/csv-stringify（TypeScript対応）  
- **テスト**: Vitest（TypeScript対応）

## フロントエンド
### アーキテクチャ設計 | フロントエンド  
  
#### UI構成  
1. **メインウィンドウ**  
    - 分割パネルレイアウト  
    - ナビゲーションツリー（左側）  
    - 編集領域（中央）  
    - プレビュー領域（右側）  
  
2. **コンポーネント構成**  
    - テスト問題ツリービュー  
    - テキストエディタ（LaTeX対応）  
    - LaTeXプレビューパネル  
    - ツールバー・メニュー  
  
#### 状態管理  
- **リアクティブな状態管理**  
    - 編集内容のリアルタイム反映  
    - 変更追跡と保存状態管理  
  
#### レスポンシブデザイン  
- パネルサイズの動的調整  
- 最小ウィンドウサイズの保証  
  
#### アクセシビリティ  
- キーボードショートカット  
- スクリーンリーダー対応  
  
#### 技術スタック  
- **フレームワーク**:  Vue.js 3 + TypeScript  
- **UIライブラリ**: Element Plus（TypeScript対応）  
- **エディタ**: CodeMirror 6（TypeScript対応）  
- **数式レンダリング**: MathJax（@types/mathjax）  
- **状態管理**: Pinia（Vue.js 3向け型安全な状態管理）

---
(c) 株式会社電通総研